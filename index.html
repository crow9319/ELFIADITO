<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>ElFiadito</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // 🔥 CONFIG FIREBASE
    const firebaseConfig = {
      apiKey: "TU_API_KEY",
      authDomain: "TU_PROYECTO.firebaseapp.com",
      projectId: "TU_PROYECTO",
      storageBucket: "TU_PROYECTO.appspot.com",
      messagingSenderId: "000000000000",
      appId: "1:000000000000:web:xxxxxxxxxxxxx"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // LOGIN TENDERO (CON CORREO/CONTRASEÑA)
    document.addEventListener("DOMContentLoaded", () => {
      const formTendero = document.getElementById("formTendero");
      const formCliente = document.getElementById("formCliente");
      const formRegistrarCliente = document.getElementById("formRegistrarCliente");
      const formActualizarSaldo = document.getElementById("formActualizarSaldo");

      formTendero.addEventListener("submit", async (e) => {
        e.preventDefault();
        const email = document.getElementById("emailTendero").value;
        const password = document.getElementById("passTendero").value;

        try {
          await signInWithEmailAndPassword(auth, email, password);
          document.getElementById("loginTendero").style.display = "none";
          document.getElementById("panelTendero").style.display = "block";
        } catch (err) {
          alert("Error en login tendero: " + err.message);
        }
      });

      // LOGIN CLIENTE SOLO CON APODO
      formCliente.addEventListener("submit", async (e) => {
        e.preventDefault();
        const apodo = document.getElementById("apodo").value.toLowerCase();

        try {
          const ref = doc(db, "clientes", apodo);
          const snap = await getDoc(ref);

          if (snap.exists()) {
            document.getElementById("saldoCliente").textContent =
              "Saldo de " + apodo + ": $" + snap.data().saldo;
            document.getElementById("loginCliente").style.display = "none";
            document.getElementById("panelCliente").style.display = "block";
          } else {
            alert("⚠️ Cliente no encontrado, revisa el apodo.");
          }
        } catch (err) {
          alert("Error al consultar saldo: " + err.message);
        }
      });

      // REGISTRAR CLIENTE NUEVO
      formRegistrarCliente.addEventListener("submit", async (e) => {
        e.preventDefault();
        const nombre = document.getElementById("nombreCliente").value.toLowerCase();
        const deuda = parseFloat(document.getElementById("deudaCliente").value);

        try {
          await setDoc(doc(db, "clientes", nombre), { saldo: deuda });
          alert("Cliente registrado con saldo $" + deuda);
          formRegistrarCliente.reset();
        } catch (err) {
          alert("Error registrando cliente: " + err.message);
        }
      });

      // ACTUALIZAR SALDO EXISTENTE
      formActualizarSaldo.addEventListener("submit", async (e) => {
        e.preventDefault();
        const nombre = document.getElementById("nombreSaldo").value.toLowerCase();
        const monto = parseFloat(document.getElementById("montoSaldo").value);

        try {
          const ref = doc(db, "clientes", nombre);
          const snap = await getDoc(ref);

          if (snap.exists()) {
            await updateDoc(ref, { saldo: snap.data().saldo + monto });
            alert("Saldo actualizado");
          } else {
            alert("Cliente no existe");
          }
          formActualizarSaldo.reset();
        } catch (err) {
          alert("Error actualizando saldo: " + err.message);
        }
      });
    });
  </script>
</head>
<body>
  <h1>📒 ElFiadito</h1>

  <!-- LOGIN TENDERO -->
  <div id="loginTendero">
    <h2>
