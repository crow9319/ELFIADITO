<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>App del Tendero</title>
  <script type="module">
    // ================== ConfiguraciÃ³n Firebase ==================
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { 
      getFirestore, collection, addDoc, onSnapshot, updateDoc, doc, query, where, getDocs 
    } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBdh3PMDoil-PGAcblNVqeJbgehXV1aM8w",
      authDomain: "elfiadito-f0b09.firebaseapp.com",
      projectId: "elfiadito-f0b09",
      storageBucket: "elfiadito-f0b09.appspot.com",
      messagingSenderId: "595543495661",
      appId: "1:595543495661:web:808e79caa9ea6968de4",
      measurementId: "G-RD8QV6315S"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // ================== Panel del Tendero ==================
    async function registrarCliente() {
      const nombre = document.getElementById("nombre").value.trim();
      const saldo = Number(document.getElementById("saldo").value) || 0;

      if (!nombre) {
        alert("Escribe un nombre o apodo");
        return;
      }

      await addDoc(collection(db, "clientes"), { nombre, saldo });
      document.getElementById("nombre").value = "";
      document.getElementById("saldo").value = "";
    }

    function cargarClientes() {
      const lista = document.getElementById("lista-clientes");
      onSnapshot(collection(db, "clientes"), (snapshot) => {
        lista.innerHTML = "";
        snapshot.forEach((docSnap) => {
          const cliente = docSnap.data();
          const li = document.createElement("li");
          li.textContent = `${cliente.nombre} â€” Saldo: $${cliente.saldo} `;

          const btnMenos = document.createElement("button");
          btnMenos.textContent = "-1000";
          btnMenos.onclick = () => modificarSaldo(docSnap.id, cliente.saldo - 1000);

          const btnMas = document.createElement("button");
          btnMas.textContent = "+1000";
          btnMas.onclick = () => modificarSaldo(docSnap.id, cliente.saldo + 1000);

          li.appendChild(btnMenos);
          li.appendChild(btnMas);
          lista.appendChild(li);
        });
      });
    }

    async function modificarSaldo(id, nuevoSaldo) {
      const ref = doc(db, "clientes", id);
      await updateDoc(ref, { saldo: nuevoSaldo });
    }

    // ================== Panel del Cliente ==================
    async function buscarCliente() {
      const apodo = document.getElementById("apodo").value.trim();
      const salida = document.getElementById("resultado");
      if (!apodo) {
        salida.textContent = "Escribe tu apodo.";
        return;
      }

      const q = query(collection(db, "clientes"), where("nombre", "==", apodo));
      const snapshot = await getDocs(q);

      if (snapshot.empty) {
        salida.textContent = "Cliente no encontrado.";
        return;
      }

      const data = snapshot.docs[0].data();
      salida.textContent = `${data.nombre}, tu saldo es: $${data.saldo}`;
    }

    // ================== Inicializar ==================
    window.onload = () => {
      document.getElementById("registrar").addEventListener("click", registrarCliente);
      document.getElementById("consultar").addEventListener("click", buscarCliente);
      cargarClientes();
    };
  </script>
</head>
<body>
  <h2>ğŸ“Œ Panel del Tendero</h2>
  <input id="nombre" placeholder="Nombre o apodo">
  <input id="saldo" type="number" placeholder="Saldo inicial">
  <button id="registrar">Registrar</button>

  <h3>Lista de clientes</h3>
  <ul id="lista-clientes"></ul>

  <hr>

  <h2>ğŸ‘¤ Panel del Cliente</h2>
  <input id="apodo" placeholder="Escribe tu apodo">
  <button id="consultar">Consultar saldo</button>
  <p id="resultado"></p>
</body>
</html>
